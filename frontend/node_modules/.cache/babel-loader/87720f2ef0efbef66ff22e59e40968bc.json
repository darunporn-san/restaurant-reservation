{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nimport React, { PureComponent } from 'react';\nimport { createPortal } from 'react-dom';\nimport Select from 'react-select';\nimport createFocusTrap from 'focus-trap';\nimport { Manager, Reference, Popper } from 'react-popper';\nimport NodeResolver from 'react-node-resolver';\nimport shallowEqualObjects from 'shallow-equal/objects';\nimport { N80 } from '@atlaskit/theme/colors';\nimport { MenuDialog, DummyControl, defaultComponents } from './components';\n/** Are we rendering on the client or server? */\n\nvar canUseDOM = function canUseDOM() {\n  return Boolean(typeof window !== 'undefined' && window.document && window.document.createElement);\n}; // ==============================\n// Types\n// ==============================\n// ==============================\n// Class\n// ==============================\n\n\nvar defaultPopperProps = {\n  modifiers: [{\n    name: 'offset',\n    options: {\n      offset: [0, 8]\n    }\n  }, {\n    name: 'preventOverflow',\n    enabled: true,\n    options: {\n      padding: 5,\n      boundary: 'clippingParents',\n      altAxis: true,\n      altBoundary: true\n    }\n  }],\n  placement: 'bottom-start'\n};\n\nvar isEmpty = function isEmpty(obj) {\n  return Object.keys(obj).length === 0;\n};\n\nvar PopupSelect = /*#__PURE__*/function (_PureComponent) {\n  _inherits(PopupSelect, _PureComponent);\n\n  var _super = _createSuper(PopupSelect);\n\n  function PopupSelect() {\n    var _this;\n\n    _classCallCheck(this, PopupSelect);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"focusTrap\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"menuRef\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"selectRef\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"targetRef\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"defaultStyles\", {\n      groupHeading: function groupHeading(provided) {\n        return _objectSpread(_objectSpread({}, provided), {}, {\n          color: N80\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isOpen: false,\n      mergedComponents: defaultComponents,\n      mergedPopperProps: defaultPopperProps\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleKeyDown\", function (event) {\n      switch (event.key) {\n        case 'Escape':\n        case 'Esc':\n          _this.close();\n\n          break;\n\n        default:\n      }\n\n      if (_this.props.handleKeyDown) {\n        _this.props.handleKeyDown(event);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleClick\", function (_ref) {\n      var target = _ref.target;\n      var isOpen = _this.state.isOpen; // appease flow\n\n      if (!(target instanceof Element)) {\n        return;\n      } // NOTE: Why not use the <Blanket /> component to close?\n      // We don't want to interupt the user's flow. Taking this approach allows\n      // user to click \"through\" to other elements and close the popout.\n\n\n      if (isOpen && _this.menuRef && !_this.menuRef.contains(target)) {\n        _this.close();\n      } // open on target click -- we can't trust consumers to spread the onClick\n      // property to the target\n\n\n      if (!isOpen && _this.targetRef && _this.targetRef.contains(target)) {\n        _this.open();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSelectChange\", function (value, actionMeta) {\n      var _this$props = _this.props,\n          closeMenuOnSelect = _this$props.closeMenuOnSelect,\n          onChange = _this$props.onChange;\n\n      if (closeMenuOnSelect && actionMeta.action !== 'clear') {\n        _this.close();\n      }\n\n      if (onChange) {\n        onChange(value, actionMeta);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"open\", function () {\n      var onOpen = _this.props.onOpen;\n\n      if (onOpen) {\n        onOpen();\n      }\n\n      _this.setState({\n        isOpen: true\n      }, _this.initialiseFocusTrap);\n\n      if (_this.selectRef) {\n        _this.selectRef.select.openMenu('first'); // HACK\n\n      }\n\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      window.addEventListener('keydown', _this.handleKeyDown, true);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"initialiseFocusTrap\", function () {\n      if (!_this.menuRef) {\n        return;\n      }\n\n      var trapConfig = {\n        clickOutsideDeactivates: true,\n        escapeDeactivates: true,\n        fallbackFocus: _this.menuRef,\n        returnFocusOnDeactivate: true\n      };\n      _this.focusTrap = createFocusTrap(_this.menuRef, trapConfig); // allow time for the HTMLElement to render\n\n      setTimeout(function () {\n        return _this.focusTrap.activate();\n      }, 1);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"close\", function () {\n      var onClose = _this.props.onClose;\n\n      if (onClose) {\n        onClose();\n      }\n\n      _this.setState({\n        isOpen: false\n      });\n\n      if (_this.focusTrap) {\n        _this.focusTrap.deactivate();\n      }\n\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      window.removeEventListener('keydown', _this.handleKeyDown, true);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"resolveTargetRef\", function (popperRef) {\n      return function (ref) {\n        // avoid thrashing fn calls\n        if (!_this.targetRef && popperRef && ref) {\n          _this.targetRef = ref;\n\n          if (typeof popperRef === 'function') {\n            popperRef(ref);\n          } else {\n            popperRef.current = ref;\n          }\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"resolveMenuRef\", function (popperRef) {\n      return function (ref) {\n        _this.menuRef = ref;\n\n        if (typeof popperRef === 'function') {\n          popperRef(ref);\n        } else {\n          popperRef.current = ref;\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getSelectRef\", function (ref) {\n      _this.selectRef = ref;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getItemCount\", function () {\n      var options = _this.props.options;\n      var count = 0;\n      options.forEach(function (groupOrOption) {\n        if (groupOrOption.options) {\n          groupOrOption.options.forEach(function () {\n            return count++;\n          });\n        } else {\n          count++;\n        }\n      });\n      return count;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getMaxHeight\", function () {\n      var maxMenuHeight = _this.props.maxMenuHeight;\n\n      if (!_this.selectRef) {\n        return maxMenuHeight;\n      } // subtract the control height to maintain consistency\n\n\n      var showSearchControl = _this.showSearchControl();\n\n      var controlRef = _this.selectRef.select.controlRef; // @ts-ignore React-select provides incomplete types for controlRef\n\n      var offsetHeight = showSearchControl ? controlRef.offsetHeight : 0;\n      var maxHeight = maxMenuHeight - offsetHeight;\n      return maxHeight;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showSearchControl\", function () {\n      var searchThreshold = _this.props.searchThreshold;\n      return _this.getItemCount() > searchThreshold;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderSelect\", function () {\n      var _this$props2 = _this.props,\n          footer = _this$props2.footer,\n          maxMenuWidth = _this$props2.maxMenuWidth,\n          minMenuWidth = _this$props2.minMenuWidth,\n          target = _this$props2.target,\n          props = _objectWithoutProperties(_this$props2, [\"footer\", \"maxMenuWidth\", \"minMenuWidth\", \"target\"]);\n\n      var _this$state = _this.state,\n          isOpen = _this$state.isOpen,\n          mergedComponents = _this$state.mergedComponents,\n          mergedPopperProps = _this$state.mergedPopperProps;\n\n      var showSearchControl = _this.showSearchControl();\n\n      var portalDestination = canUseDOM() ? document.body : null;\n\n      var components = _objectSpread(_objectSpread({}, mergedComponents), {}, {\n        Control: showSearchControl ? mergedComponents.Control : DummyControl\n      });\n\n      if (!portalDestination || !isOpen) {\n        return null;\n      }\n\n      var popper = /*#__PURE__*/React.createElement(Popper, mergedPopperProps, function (_ref2) {\n        var placement = _ref2.placement,\n            ref = _ref2.ref,\n            style = _ref2.style;\n        return /*#__PURE__*/React.createElement(NodeResolver, {\n          innerRef: _this.resolveMenuRef(ref)\n        }, /*#__PURE__*/React.createElement(MenuDialog, {\n          style: style,\n          \"data-placement\": placement,\n          minWidth: minMenuWidth,\n          maxWidth: maxMenuWidth\n        }, /*#__PURE__*/React.createElement(Select, _extends({\n          backspaceRemovesValue: false,\n          controlShouldRenderValue: false,\n          isClearable: false,\n          tabSelectsValue: false,\n          menuIsOpen: true,\n          ref: _this.getSelectRef\n        }, props, {\n          isSearchable: showSearchControl,\n          styles: _objectSpread(_objectSpread({}, _this.defaultStyles), props.styles),\n          maxMenuHeight: _this.getMaxHeight(),\n          components: components,\n          onChange: _this.handleSelectChange\n        })), footer));\n      });\n      return mergedPopperProps.strategy === 'fixed' ? popper : /*#__PURE__*/createPortal(popper, portalDestination);\n    });\n\n    return _this;\n  }\n\n  _createClass(PopupSelect, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      window.addEventListener('click', this.handleClick, true);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      window.removeEventListener('click', this.handleClick, true);\n      window.removeEventListener('keydown', this.handleKeyDown, true);\n    } // Event Handlers\n    // ==============================\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var target = this.props.target;\n      var isOpen = this.state.isOpen;\n      return /*#__PURE__*/React.createElement(Manager, null, /*#__PURE__*/React.createElement(Reference, null, function (_ref3) {\n        var ref = _ref3.ref;\n        return target && target({\n          ref: _this2.resolveTargetRef(ref),\n          isOpen: isOpen\n        });\n      }), this.renderSelect());\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(props, state) {\n      var newState = {}; // Merge consumer and default popper props\n\n      var mergedPopperProps = _objectSpread(_objectSpread({}, defaultPopperProps), props.popperProps);\n\n      if (!shallowEqualObjects(mergedPopperProps, state.mergedPopperProps)) {\n        newState.mergedPopperProps = mergedPopperProps;\n      } // Merge consumer and default components\n\n\n      var mergedComponents = _objectSpread(_objectSpread({}, defaultComponents), props.components);\n\n      if (!shallowEqualObjects(mergedComponents, state.mergedComponents)) {\n        newState.mergedComponents = mergedComponents;\n      }\n\n      if (!isEmpty(newState)) {\n        return newState;\n      }\n\n      return null;\n    }\n  }]);\n\n  return PopupSelect;\n}(PureComponent);\n\n_defineProperty(PopupSelect, \"defaultProps\", {\n  closeMenuOnSelect: true,\n  components: {},\n  maxMenuHeight: 300,\n  maxMenuWidth: 440,\n  minMenuWidth: 220,\n  popperProps: {},\n  searchThreshold: 5,\n  styles: {},\n  options: []\n});\n\nexport { PopupSelect as default };","map":{"version":3,"sources":["/Users/dsmint/restaurantreservation/node_modules/@atlaskit/select/dist/esm/PopupSelect/PopupSelect.js"],"names":["_extends","_objectWithoutProperties","_classCallCheck","_createClass","_assertThisInitialized","_inherits","_possibleConstructorReturn","_getPrototypeOf","_defineProperty","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","constructor","Reflect","construct","sham","Proxy","Boolean","prototype","valueOf","call","e","React","PureComponent","createPortal","Select","createFocusTrap","Manager","Reference","Popper","NodeResolver","shallowEqualObjects","N80","MenuDialog","DummyControl","defaultComponents","canUseDOM","window","document","createElement","defaultPopperProps","modifiers","name","options","offset","enabled","padding","boundary","altAxis","altBoundary","placement","isEmpty","obj","PopupSelect","_PureComponent","_super","_this","_len","args","Array","_key","concat","groupHeading","provided","color","isOpen","mergedComponents","mergedPopperProps","event","close","props","handleKeyDown","_ref","state","Element","menuRef","contains","targetRef","open","value","actionMeta","_this$props","closeMenuOnSelect","onChange","action","onOpen","setState","initialiseFocusTrap","selectRef","select","openMenu","addEventListener","trapConfig","clickOutsideDeactivates","escapeDeactivates","fallbackFocus","returnFocusOnDeactivate","focusTrap","setTimeout","activate","onClose","deactivate","removeEventListener","popperRef","ref","current","count","groupOrOption","maxMenuHeight","showSearchControl","controlRef","offsetHeight","maxHeight","searchThreshold","getItemCount","_this$props2","footer","maxMenuWidth","minMenuWidth","_this$state","portalDestination","body","components","Control","popper","_ref2","style","innerRef","resolveMenuRef","minWidth","maxWidth","backspaceRemovesValue","controlShouldRenderValue","isClearable","tabSelectsValue","menuIsOpen","getSelectRef","isSearchable","styles","defaultStyles","getMaxHeight","handleSelectChange","strategy","componentDidMount","handleClick","componentWillUnmount","render","_this2","_ref3","resolveTargetRef","renderSelect","getDerivedStateFromProps","newState","popperProps","default"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { PureComponent } from 'react';\nimport { createPortal } from 'react-dom';\nimport Select from 'react-select';\nimport createFocusTrap from 'focus-trap';\nimport { Manager, Reference, Popper } from 'react-popper';\nimport NodeResolver from 'react-node-resolver';\nimport shallowEqualObjects from 'shallow-equal/objects';\nimport { N80 } from '@atlaskit/theme/colors';\nimport { MenuDialog, DummyControl, defaultComponents } from './components';\n\n/** Are we rendering on the client or server? */\nvar canUseDOM = function canUseDOM() {\n  return Boolean(typeof window !== 'undefined' && window.document && window.document.createElement);\n}; // ==============================\n// Types\n// ==============================\n\n\n// ==============================\n// Class\n// ==============================\nvar defaultPopperProps = {\n  modifiers: [{\n    name: 'offset',\n    options: {\n      offset: [0, 8]\n    }\n  }, {\n    name: 'preventOverflow',\n    enabled: true,\n    options: {\n      padding: 5,\n      boundary: 'clippingParents',\n      altAxis: true,\n      altBoundary: true\n    }\n  }],\n  placement: 'bottom-start'\n};\n\nvar isEmpty = function isEmpty(obj) {\n  return Object.keys(obj).length === 0;\n};\n\nvar PopupSelect = /*#__PURE__*/function (_PureComponent) {\n  _inherits(PopupSelect, _PureComponent);\n\n  var _super = _createSuper(PopupSelect);\n\n  function PopupSelect() {\n    var _this;\n\n    _classCallCheck(this, PopupSelect);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"focusTrap\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"menuRef\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"selectRef\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"targetRef\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"defaultStyles\", {\n      groupHeading: function groupHeading(provided) {\n        return _objectSpread(_objectSpread({}, provided), {}, {\n          color: N80\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isOpen: false,\n      mergedComponents: defaultComponents,\n      mergedPopperProps: defaultPopperProps\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleKeyDown\", function (event) {\n      switch (event.key) {\n        case 'Escape':\n        case 'Esc':\n          _this.close();\n\n          break;\n\n        default:\n      }\n\n      if (_this.props.handleKeyDown) {\n        _this.props.handleKeyDown(event);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleClick\", function (_ref) {\n      var target = _ref.target;\n      var isOpen = _this.state.isOpen; // appease flow\n\n      if (!(target instanceof Element)) {\n        return;\n      } // NOTE: Why not use the <Blanket /> component to close?\n      // We don't want to interupt the user's flow. Taking this approach allows\n      // user to click \"through\" to other elements and close the popout.\n\n\n      if (isOpen && _this.menuRef && !_this.menuRef.contains(target)) {\n        _this.close();\n      } // open on target click -- we can't trust consumers to spread the onClick\n      // property to the target\n\n\n      if (!isOpen && _this.targetRef && _this.targetRef.contains(target)) {\n        _this.open();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSelectChange\", function (value, actionMeta) {\n      var _this$props = _this.props,\n          closeMenuOnSelect = _this$props.closeMenuOnSelect,\n          onChange = _this$props.onChange;\n\n      if (closeMenuOnSelect && actionMeta.action !== 'clear') {\n        _this.close();\n      }\n\n      if (onChange) {\n        onChange(value, actionMeta);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"open\", function () {\n      var onOpen = _this.props.onOpen;\n\n      if (onOpen) {\n        onOpen();\n      }\n\n      _this.setState({\n        isOpen: true\n      }, _this.initialiseFocusTrap);\n\n      if (_this.selectRef) {\n        _this.selectRef.select.openMenu('first'); // HACK\n\n      }\n\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      window.addEventListener('keydown', _this.handleKeyDown, true);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"initialiseFocusTrap\", function () {\n      if (!_this.menuRef) {\n        return;\n      }\n\n      var trapConfig = {\n        clickOutsideDeactivates: true,\n        escapeDeactivates: true,\n        fallbackFocus: _this.menuRef,\n        returnFocusOnDeactivate: true\n      };\n      _this.focusTrap = createFocusTrap(_this.menuRef, trapConfig); // allow time for the HTMLElement to render\n\n      setTimeout(function () {\n        return _this.focusTrap.activate();\n      }, 1);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"close\", function () {\n      var onClose = _this.props.onClose;\n\n      if (onClose) {\n        onClose();\n      }\n\n      _this.setState({\n        isOpen: false\n      });\n\n      if (_this.focusTrap) {\n        _this.focusTrap.deactivate();\n      }\n\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      window.removeEventListener('keydown', _this.handleKeyDown, true);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"resolveTargetRef\", function (popperRef) {\n      return function (ref) {\n        // avoid thrashing fn calls\n        if (!_this.targetRef && popperRef && ref) {\n          _this.targetRef = ref;\n\n          if (typeof popperRef === 'function') {\n            popperRef(ref);\n          } else {\n            popperRef.current = ref;\n          }\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"resolveMenuRef\", function (popperRef) {\n      return function (ref) {\n        _this.menuRef = ref;\n\n        if (typeof popperRef === 'function') {\n          popperRef(ref);\n        } else {\n          popperRef.current = ref;\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getSelectRef\", function (ref) {\n      _this.selectRef = ref;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getItemCount\", function () {\n      var options = _this.props.options;\n      var count = 0;\n      options.forEach(function (groupOrOption) {\n        if (groupOrOption.options) {\n          groupOrOption.options.forEach(function () {\n            return count++;\n          });\n        } else {\n          count++;\n        }\n      });\n      return count;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getMaxHeight\", function () {\n      var maxMenuHeight = _this.props.maxMenuHeight;\n\n      if (!_this.selectRef) {\n        return maxMenuHeight;\n      } // subtract the control height to maintain consistency\n\n\n      var showSearchControl = _this.showSearchControl();\n\n      var controlRef = _this.selectRef.select.controlRef; // @ts-ignore React-select provides incomplete types for controlRef\n\n      var offsetHeight = showSearchControl ? controlRef.offsetHeight : 0;\n      var maxHeight = maxMenuHeight - offsetHeight;\n      return maxHeight;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showSearchControl\", function () {\n      var searchThreshold = _this.props.searchThreshold;\n      return _this.getItemCount() > searchThreshold;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderSelect\", function () {\n      var _this$props2 = _this.props,\n          footer = _this$props2.footer,\n          maxMenuWidth = _this$props2.maxMenuWidth,\n          minMenuWidth = _this$props2.minMenuWidth,\n          target = _this$props2.target,\n          props = _objectWithoutProperties(_this$props2, [\"footer\", \"maxMenuWidth\", \"minMenuWidth\", \"target\"]);\n\n      var _this$state = _this.state,\n          isOpen = _this$state.isOpen,\n          mergedComponents = _this$state.mergedComponents,\n          mergedPopperProps = _this$state.mergedPopperProps;\n\n      var showSearchControl = _this.showSearchControl();\n\n      var portalDestination = canUseDOM() ? document.body : null;\n\n      var components = _objectSpread(_objectSpread({}, mergedComponents), {}, {\n        Control: showSearchControl ? mergedComponents.Control : DummyControl\n      });\n\n      if (!portalDestination || !isOpen) {\n        return null;\n      }\n\n      var popper = /*#__PURE__*/React.createElement(Popper, mergedPopperProps, function (_ref2) {\n        var placement = _ref2.placement,\n            ref = _ref2.ref,\n            style = _ref2.style;\n        return /*#__PURE__*/React.createElement(NodeResolver, {\n          innerRef: _this.resolveMenuRef(ref)\n        }, /*#__PURE__*/React.createElement(MenuDialog, {\n          style: style,\n          \"data-placement\": placement,\n          minWidth: minMenuWidth,\n          maxWidth: maxMenuWidth\n        }, /*#__PURE__*/React.createElement(Select, _extends({\n          backspaceRemovesValue: false,\n          controlShouldRenderValue: false,\n          isClearable: false,\n          tabSelectsValue: false,\n          menuIsOpen: true,\n          ref: _this.getSelectRef\n        }, props, {\n          isSearchable: showSearchControl,\n          styles: _objectSpread(_objectSpread({}, _this.defaultStyles), props.styles),\n          maxMenuHeight: _this.getMaxHeight(),\n          components: components,\n          onChange: _this.handleSelectChange\n        })), footer));\n      });\n      return mergedPopperProps.strategy === 'fixed' ? popper : /*#__PURE__*/createPortal(popper, portalDestination);\n    });\n\n    return _this;\n  }\n\n  _createClass(PopupSelect, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      window.addEventListener('click', this.handleClick, true);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      window.removeEventListener('click', this.handleClick, true);\n      window.removeEventListener('keydown', this.handleKeyDown, true);\n    } // Event Handlers\n    // ==============================\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var target = this.props.target;\n      var isOpen = this.state.isOpen;\n      return /*#__PURE__*/React.createElement(Manager, null, /*#__PURE__*/React.createElement(Reference, null, function (_ref3) {\n        var ref = _ref3.ref;\n        return target && target({\n          ref: _this2.resolveTargetRef(ref),\n          isOpen: isOpen\n        });\n      }), this.renderSelect());\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(props, state) {\n      var newState = {}; // Merge consumer and default popper props\n\n      var mergedPopperProps = _objectSpread(_objectSpread({}, defaultPopperProps), props.popperProps);\n\n      if (!shallowEqualObjects(mergedPopperProps, state.mergedPopperProps)) {\n        newState.mergedPopperProps = mergedPopperProps;\n      } // Merge consumer and default components\n\n\n      var mergedComponents = _objectSpread(_objectSpread({}, defaultComponents), props.components);\n\n      if (!shallowEqualObjects(mergedComponents, state.mergedComponents)) {\n        newState.mergedComponents = mergedComponents;\n      }\n\n      if (!isEmpty(newState)) {\n        return newState;\n      }\n\n      return null;\n    }\n  }]);\n\n  return PopupSelect;\n}(PureComponent);\n\n_defineProperty(PopupSelect, \"defaultProps\", {\n  closeMenuOnSelect: true,\n  components: {},\n  maxMenuHeight: 300,\n  maxMenuWidth: 440,\n  minMenuWidth: 220,\n  popperProps: {},\n  searchThreshold: 5,\n  styles: {},\n  options: []\n});\n\nexport { PopupSelect as default };"]},"metadata":{},"sourceType":"module"}